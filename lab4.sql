create database Department;
USE Department;

CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PNAME VARCHAR(50),
    PLOC VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    PRIMARY KEY (EMPNO, INCENTIVE_DATE),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);


INSERT INTO DEPT VALUES
(10, 'HR', 'Bengaluru'),
(20, 'Finance', 'Hyderabad'),
(30, 'Engineering', 'Mysuru'),
(40, 'Marketing', 'Chennai'),
(50, 'Admin', 'Delhi'),
(60, 'Support', 'Bengaluru');


INSERT INTO EMPLOYEE VALUES
(101, 'Ravi', NULL, '2021-05-12', 60000, 10),
(102, 'Kiran', 101, '2020-07-22', 75000, 20),
(103, 'Anu', 101, '2021-03-14', 55000, 30),
(104, 'Manoj', 102, '2022-08-19', 50000, 40),
(105, 'Divya', 103, '2019-11-30', 80000, 50),
(106, 'Pooja', 101, '2021-01-02', 45000, 60);


INSERT INTO PROJECT VALUES
(201, 'Payroll', 'Hyderabad'),
(202, 'Recruitment', 'Bengaluru'),
(203, 'Inventory', 'Mysuru'),
(204, 'Campaign', 'Chennai'),
(205, 'Support Tool', 'Bengaluru');


INSERT INTO ASSIGNED_TO VALUES
(101, 202, 'Manager'),
(102, 201, 'Analyst'),
(103, 203, 'Developer'),
(104, 204, 'Designer'),
(105, 205, 'Tester'),
(106, 202, 'Support');

 
INSERT INTO INCENTIVES VALUES
(101, '2024-04-01', 5000),
(102, '2024-05-01', 4000),
(104, '2024-06-01', 3000),
(105, '2024-07-01', 6000),
(101, '2024-08-01', 2500);

SELECT DISTINCT A.EMPNO
FROM ASSIGNED_TO A
JOIN PROJECT P ON A.PNO = P.PNO
WHERE P.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT E.EMPNO
FROM EMPLOYEE E
WHERE E.EMPNO NOT IN (
    SELECT DISTINCT EMPNO FROM INCENTIVES
);

SELECT
    E.ENAME,
    E.EMPNO,
    D.DNAME,
    A.JOB_ROLE,
    D.DLOC AS DEPT_LOCATION,
    P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE D.DLOC = P.PLOC;